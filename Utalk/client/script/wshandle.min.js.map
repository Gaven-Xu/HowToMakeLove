{"version":3,"sources":["wshandle.js"],"names":["window","utalk","formatTime","date","str","getHours","getMinutes","getSeconds","console","log","wsHandle","_s","_n","this","socket","prototype","listen","event","fn","on","clearInput","focusElement","DOMArray","Array","index","alert","focus","getDate","from","to","m","value","toString","trim","data","Date","indexOf","match","input","replace","getClients","container","emit","userlist","innerHTML","key","nick","hasOwnProperty","bind","sendMessage","obj","Object","Function","sendLocalSearch","formatImageSet","imgArray","self","containerElement","document","createElement","className","i","length","imgElement","imgSrc","src","decodeBaiduImageUrl","title","setAttribute","fromSite","appendChild","searchBaiduImage","word","xhr","XMLHttpRequest","open","baiduImgArray","result","status","JSON","parse","responseText","FromURL","fromPageTitleEnc","objURL","ls","push","send","_url","f","w","k","v","1","j","u","2","t","3","h","s","4","g","5","r","q","6","p","7","e","o","8","d","n","9","c","0","b","l","a","_z2C$q","_z&e3B","AzdH3F","url","showAlert","time","showSearchResult","message","command","scrollTop","scrollHeight","showMessage","isRemote"],"mappings":"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","file":"wshandle.min.js","sourcesContent":["window.utalk = window.utalk || {};\r\n(function () {\r\n\r\n    /**\r\n     * websocket message handle object\r\n     * @param  {[type]} _s [description]\r\n     * @param  {[type]} _n [description]\r\n     * @return [type]      [description]\r\n     */\r\n    var wsHandle = function (_s, _n) {\r\n        this.socket = _s;\r\n        this.nick = _n;\r\n    }\r\n\r\n    wsHandle.prototype = {\r\n        listen: function (event, fn) {\r\n            this.socket.on(event, fn)\r\n        },\r\n        clearInput: function (DOMArray, focusElement) {\r\n            if (DOMArray instanceof Array) {\r\n                for (let index = 0; index < DOMArray.length; index++) {\r\n                    DOMArray[index].value = '';\r\n                }\r\n            } else {\r\n                alert(DOMArray + '不是数组')\r\n            }\r\n            if (focusElement) {\r\n                focusElement.focus();\r\n            }\r\n        },\r\n        getDate: function (from, to, m) {\r\n\r\n            let data = {\r\n                from: from.value.toString().trim(),\r\n                to: to.value.toString().trim() || 'all',\r\n                m: m.value.toString().trim(),\r\n                time: formatTime(new Date(), '-')\r\n            }\r\n\r\n            if (data.m.indexOf('@') == 0) {\r\n                // console.log(data.m.match(/^@(\\S+\\s*)/));\r\n                data.to = data.m.match(/^@(\\S+\\s*)/)[1].trim();\r\n                data.m = data.m.match(/^@(\\S+\\s*)/).input.replace('@' + data.to, '');\r\n                data.command = '@';\r\n            }\r\n\r\n            if (data.m.indexOf('>') == 0) {\r\n                // console.log(data.m.match(/^@(\\S+\\s*)/));\r\n                data.to = data.m.match(/^>(\\S+\\s*)/)[1].trim();\r\n                data.m = data.m.match(/^>(\\S+\\s*)/).input.replace('>', '');\r\n                data.command = '>';\r\n                console.log(data)\r\n            }\r\n\r\n            return data;\r\n        },\r\n        getClients: function (container) {\r\n            this.socket.emit('getClients', function (userlist) {\r\n                console.log(userlist);\r\n                container.innerHTML = `<option value=\"all\" selected>all</option>`;\r\n                for (var key in userlist) {\r\n                    if (userlist.hasOwnProperty(key) && key != this.nick) {\r\n                        container.innerHTML += `\r\n                            <option value=\"${key}\">${key}</option>\r\n                        `;\r\n                    }\r\n                }\r\n            }.bind(this));\r\n        },\r\n        sendMessage: function (obj, fn) {\r\n            if (obj instanceof Object && fn instanceof Function) {\r\n                this.socket.emit('message', obj, fn);\r\n            }\r\n        },\r\n        sendLocalSearch: function (obj, fn) {\r\n            if (obj instanceof Object && fn instanceof Function) {\r\n                this.socket.emit('localSearch', obj, fn);\r\n            }\r\n        },\r\n        formatImageSet: function (imgArray) {\r\n            var self = this;\r\n\r\n            if (imgArray instanceof Array) {\r\n\r\n                let containerElement = document.createElement('div');\r\n                containerElement.className = 'imgset remote';\r\n\r\n                for (var i = 0; i < imgArray.length; i++) {\r\n\r\n                    let imgElement = document.createElement('img');\r\n                    imgElement.className = 'img img' + i;\r\n                    console.log(imgArray[i].imgSrc);\r\n                    imgElement.src = self.decodeBaiduImageUrl(imgArray[i].imgSrc);\r\n                     console.log(imgElement.src);\r\n                    imgElement.title = imgArray[i].title;\r\n                    imgElement.setAttribute('test', imgArray[i].fromSite);\r\n\r\n                    containerElement.appendChild(imgElement);\r\n\r\n                    if (i == (imgArray.length - 1)) {\r\n                        return containerElement;\r\n                    }\r\n\r\n                }\r\n\r\n            } else {\r\n                console.log('error');\r\n            }\r\n\r\n\r\n\r\n        },\r\n        searchBaiduImage: function (word, fn) {\r\n            var self = this;\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open('GET', \"http://image.baidu.com/search/acjson?tn=resultjson_com&ipn=rj&ct=201326592&is=&fp=result&queryWord=\" + word + \"&cl=&lm=&ie=utf-8&oe=utf-8&adpicid=&st=&z=&ic=&word=\" + word + \"&s=&se=&tab=&width=&height=&face=&istype=&qc=&nc=&fr=&pn=60&rn=30&gsm=1e&1493171544246=\", true);\r\n            xhr.onreadystatechange = function () {\r\n\r\n                if (xhr.readyState == 4 && xhr.status == 200) {\r\n\r\n                    let baiduImgArray = JSON.parse(xhr.responseText).data;\r\n                    console.log(baiduImgArray);\r\n\r\n                    let result = [];\r\n                    let tempImgObj = [];\r\n\r\n                    for (let i = 0; i < baiduImgArray.length; i++) {\r\n                        let title = baiduImgArray[i].fromPageTitleEnc;\r\n                        let ls = baiduImgArray[i].replaceUrl ? (baiduImgArray[i].replaceUrl[1] ? baiduImgArray[i].replaceUrl[1] : baiduImgArray[i].replaceUrl[0]) : null;\r\n                        if (ls) {\r\n                            result.push({\r\n                                title: title,\r\n                                fromSite: ls.FromURL,\r\n                                imgSrc: baiduImgArray[i].objURL\r\n                                // imgSrc: ls.ObjURL\r\n                            });\r\n                        }\r\n                        if (i == (baiduImgArray.length - 1)) {\r\n                            fn(result)\r\n                        }\r\n\r\n                    }\r\n                } else {\r\n                    // console.log(xhr.readyState,xhr.status);\r\n                    return null;\r\n                }\r\n            }\r\n            xhr.send()\r\n\r\n        },\r\n        decodeBaiduImageUrl: function (_url) {\r\n\r\n            var f = { w: \"a\", k: \"b\", v: \"c\", 1: \"d\", j: \"e\", u: \"f\", 2: \"g\", i: \"h\", t: \"i\", 3: \"j\", h: \"k\", s: \"l\", 4: \"m\", g: \"n\", 5: \"o\", r: \"p\", q: \"q\", 6: \"r\", f: \"s\", p: \"t\", 7: \"u\", e: \"v\", o: \"w\", 8: \"1\", d: \"2\", n: \"3\", 9: \"4\", c: \"5\", m: \"6\", 0: \"7\", b: \"8\", l: \"9\", a: \"0\", _z2C$q: \":\", \"_z&e3B\": \".\", AzdH3F: \"/\" };\r\n            var url = _url;\r\n\r\n            var h = /(_z2C\\$q|_z&e3B|AzdH3F)/g;\r\n            var e = url.replace(h, function (t, e) { return f[e] });\r\n\r\n            var s = /([a-w\\d])/g;\r\n            e = e.replace(s, function (t, e) { return f[e] });\r\n            return e;\r\n\r\n        },\r\n        showAlert: function (container, data) {\r\n            var message = `\r\n                <div class=\"remote\">\r\n                    <div class=\"name\">\r\n                        <span>Server</span><span class=\"time\">${data.time}</span>\r\n                    </div>\r\n                    <div class=\"message\">\r\n                        <span>${data.m}</span>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        },\r\n        showSearchResult: function (container, data) {\r\n            console.log(data)\r\n            if (data.command && data.command == \">\") {\r\n                container.appendChild(data.m);\r\n                container.scrollTop = container.scrollHeight;\r\n                return true;\r\n            }\r\n        },\r\n        showMessage: function (container, data, isRemote) {\r\n\r\n            if (!isRemote) {\r\n                var message = `\r\n                    <div class=\"local\">\r\n                        <div class=\"name\">\r\n                            <span>${data.from}</span><span class=\"time\">${data.time}</span>\r\n                        </div>\r\n                        <div class=\"message\">\r\n                            <span>${data.m}</span>\r\n                        </div>\r\n                    </div>\r\n                    `;\r\n            } else {\r\n                var message = `\r\n                    <div class=\"remote\">\r\n                        <div class=\"name\">\r\n                            <span>${data.from}</span><span class=\"time\">${data.time}</span>\r\n                        </div>\r\n                        <div class=\"message\">\r\n                            <span>${data.m}</span>\r\n                        </div>\r\n                    </div>\r\n                    `;\r\n            }\r\n\r\n            container.innerHTML += message;\r\n            container.scrollTop = container.scrollHeight;\r\n            return true;\r\n        }\r\n    }\r\n\r\n    function formatTime(date, str) {\r\n        if (typeof str == \"string\") {\r\n            return date.getHours() + str + date.getMinutes() + str + date.getSeconds();\r\n        } else {\r\n            console.log('the second argument should be string');\r\n        }\r\n    }\r\n\r\n    utalk.wsHandle = wsHandle;\r\n\r\n})()\r\n"]}