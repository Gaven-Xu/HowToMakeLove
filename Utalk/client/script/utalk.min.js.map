{"version":3,"sources":["utalk.js"],"names":["messageHandle","data","wsHandle","getDate","input","from","to","message","hasOwnProperty","command","m","trim","length","sendMessage","showMessage","Box","isRemote","clearInput","domSet","formatImageSet","imgArray","sendLocalSearch","_data","console","log","showSearchResult","set","document","getElementById","shadow","shiftDown","localStorage","getItem","cached_nickname","value","nick","focus","e","preventDefault","addEventListener","socket","io","on","utalk","code","emit","placeholder","setItem","style","opacity","getClients","listen","keyCode","scrollTop","scrollHeight"],"mappings":"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","file":"utalk.min.js","sourcesContent":["(function () {\r\n\r\n    var set = document.getElementById('set');\r\n    var Box = document.getElementById('message_box');\r\n    var input = document.getElementById('input');\r\n    var shadow = document.getElementById('shadow');\r\n    var isRemote = true;\r\n    var shiftDown = false;\r\n    var wsHandle = {};\r\n    var socket = {};\r\n\r\n    /**\r\n     * @param {string} cached_nickname use cached_nickname if is in localstorage. Otherwise use an input nickname\r\n     */\r\n    var cached_nickname = localStorage.getItem('nick');\r\n    if (cached_nickname) {\r\n        var nick = localStorage.getItem('nick');\r\n        document.getElementById('nick').value = nick;\r\n        document.getElementById('nick').focus();\r\n    }\r\n    shadow.addEventListener('click', function () {\r\n        set.nick.focus();\r\n    })\r\n    set.addEventListener('submit', function (e) {\r\n        e.preventDefault();\r\n        var nick = set.nick.value.trim();\r\n        if (nick.length >= 5) {\r\n\r\n            // setTimeout(function () {\r\n            //     shadow.style.display = 'none';\r\n\r\n            socket = io('http://localhost:3000/');\r\n\r\n            // socket默认事件 连接成功\r\n            socket.on('connect', function () {\r\n\r\n                wsHandle = new utalk.wsHandle(socket, nick); // wsHandle can use this socket\r\n\r\n                socket.emit('regist', nick, function (data) {\r\n                    switch (data.code) {\r\n                        case 0: {\r\n                            // 用户名存在\r\n                            set.nick.placeholder = data.m;\r\n                            set.nick.value = '';\r\n                            set.nick.focus();\r\n                        } break;\r\n                        case 1: {\r\n                            // 注册成功\r\n                            localStorage.setItem('nick', nick);\r\n                            shadow.style.opacity = 0;\r\n                            input.from.value = nick;\r\n                            input.message.focus();\r\n\r\n                            setTimeout(function () {\r\n                                shadow.style.display = 'none';\r\n                            }, 505);\r\n\r\n                        } break;\r\n                        default: {\r\n\r\n                        } break;\r\n                    }\r\n\r\n                })\r\n\r\n                wsHandle.getClients(input.to);\r\n\r\n                wsHandle.listen('message', function (data) {\r\n                    wsHandle.showMessage(Box, data, isRemote);\r\n                })\r\n\r\n                wsHandle.listen('new_user', function () {\r\n                    wsHandle.getClients(input.to);\r\n                })\r\n\r\n                wsHandle.listen('user_not_in', function (data) {\r\n                    wsHandle.showMessage(Box, data, isRemote);\r\n                })\r\n            })\r\n\r\n        } else {\r\n            set.nick.placeholder = 'Try 5-20 letter';\r\n            set.nick.value = '';\r\n            set.nick.focus();\r\n        }\r\n    })\r\n\r\n    function messageHandle() {\r\n        var data = wsHandle.getDate(input.from, input.to, input.message)\r\n        if (data.hasOwnProperty('command')) {\r\n\r\n            if (data.command == '@' && data.m.trim().length > 0) {\r\n\r\n                wsHandle.sendMessage(data, function (data) {\r\n                    wsHandle.showMessage(Box, data, !isRemote)\r\n                    wsHandle.clearInput([input.message], input.message);\r\n                });\r\n\r\n            } else if (data.command == '>') {\r\n\r\n                wsHandle.searchBaiduImage(data.m, function (imgArray) {\r\n                    var domSet = wsHandle.formatImageSet(imgArray);\r\n                    data.m = imgArray;\r\n                    wsHandle.sendLocalSearch(data, function (_data) {\r\n                        _data.m = domSet;\r\n                        console.log(_data);\r\n                        wsHandle.showSearchResult(Box, _data);\r\n                        wsHandle.clearInput([input.message], input.message);\r\n                    })\r\n                });\r\n\r\n            }\r\n\r\n\r\n        } else {\r\n\r\n            if (data.m.trim().length > 0) {\r\n\r\n                wsHandle.sendMessage(data, function (data) {\r\n                    wsHandle.showMessage(Box, data, !isRemote)\r\n                    wsHandle.clearInput([input.message], input.message);\r\n                });\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    input.addEventListener('submit', function (e) {\r\n\r\n        e.preventDefault();\r\n\r\n        messageHandle();\r\n\r\n    })\r\n\r\n    message.addEventListener('keydown', function (e) {\r\n\r\n        if (e.keyCode == \"16\" && !shiftDown) { // only Shift\r\n            shiftDown = true;\r\n        }\r\n\r\n        if (e.keyCode == \"13\" && !shiftDown) { // only Enter\r\n\r\n            e.preventDefault();\r\n\r\n            messageHandle();\r\n\r\n        }\r\n\r\n        if (e.keyCode == \"13\" && shiftDown) { //Shift + Enter\r\n            e.preventDefault();\r\n            input.message.value += '\\n';\r\n            input.message.scrollTop = input.message.scrollHeight;\r\n        }\r\n\r\n    })\r\n\r\n    message.addEventListener('keyup', function (e) {\r\n\r\n        if (e.keyCode == \"16\") { // Shift\r\n\r\n            shiftDown = false;\r\n\r\n        }\r\n\r\n    })\r\n\r\n    /**\r\n     * 如果已经成功跟某个人私信过，input.to的selected应该为这个人的名字\r\n     *\r\n     * 如果按@符号，则开始监听输入，每次keyup，取@后面的字符串，input.to的selected应该为这个人的名字。如果按space，则停止监听，\r\n     */\r\n\r\n})()\r\n"]}